- Test environments
    - [x] dev
        - Ajustar ambiente dev para rodar com o supervisor
    - [x] cloud

      - [x] Revisar o deploy para o cloud
        - [x] settings.py
            ALLOWED_HOSTS
            DEBUG
        - [x] supervisor.conf
            - PORT (variável de ambiente)
        - [x] Dockerfile
            - EXPOSED PORT
        - [x] docker-entrypoint.sh
            - Eliminar testes desnecessarios

      - [] Implementar task default para testar o celery

    monitoring/tasks.py
    ```python  
    from celery import shared_task
    import logging
    logger = logging.getLogger(__name__)

    @shared_task
    def debug_task():
        logger.info("Celery debug task ran successfully!")
        return "Debug task completed"
    ```

    ```python
    from monitoring.tasks import debug_task
    debug_task.delay()
    ```

- Logs rotation
    - [x] factorydash
    - [x] celery
    - [x] gunicorn
    - [x] supervisor

- User interface
    - Following Grok assistance
    - Links: 
        https://factorydash-production.up.railway.app/
        https://factorydash-production.up.railway.app/health/
    - [] Enhance docstrings and type hints
        - [x] models.py
        - [x] tasks.py
        - [x] urls.py
    - New files for UI
        - [] views.py
        - [] consumers.py
        - [] routing.py
        - [] tasks.py (update)
        - [] urls.py (update)
        - [] dashboard.html
        - [] view.py
    - Setup
        - [] requirements.txt
        - [] settings.py
        - [] asgi.py
    - Deal with improvements
        - [] Gemini
        - [] ChatGpt
        - [] Grok



- Documentation
    - [] Code
    - [] README
    - [] Dockerhub (repository)
        - [] Improve the versioning (use a env var instead of github.sha)


## DESCRIPTION

You are a full-stack software developer highly experienced with Server Sider Rendering.
You will create the files for the user interface of the factorydash project.
This project aims to provide Real-time insights for Smart Manufacturing.
I am working on this project for my porftolio.
I intend to strengthen my skills in modern Server-Side Rendering with this stage of the project.
Think as a a strict IT interviewer.

## CONTEXT

- Generate docstrings for all python files, following best practices.
- Use type hints for all functions and methods.
- A working dashboard that pulls & displays NIST machine data
- Django Templates + Bootstrap for UI (keeping it simple).
- Add Real-Time Data Updates 
  - Use Django’s WebSockets (Django Channels).
  - Implement live updates for key metrics on the dashboard.
  - Show a timestamp indicating when data was last updated.
- Build a clean dashboard layout (cards, tables, charts).
- Set up a navbar with links to key views.
- Implement Data Display.
  - Create views & templates to display machine metrics.
  - Use Django ORM queries to retrieve data.
  - Panels for monitoring machine performance:
    - Temperature;
    - Spindle Speed;
    - Feed Rate;
    - Emergency Stop Status;
    - Current machine status (e.g., running/stopped);
    - Recent force readings (F, Fz);
    - Tool usage statistics.
- Add a "Live Data" Indicator:
  - Show last updated timestamp to indicate when the data was last fetched.
- Enable Filtering by Time Range
 - Allow users to view data for the last hour, last day, last week.

Next I will share some files with you.

## ATTACHMENTS

- Directory tree

.
├── Dockerfile
├── LICENSE
├── Makefile
├── README.md
├── TODO
├── app
│   └── factorydash
│       ├── celerybeat-schedule
│       ├── celerybeat-schedule-shm
│       ├── celerybeat-schedule-wal
│       ├── factorydash
│       │   ├── __init__.py
│       │   ├── asgi.py
│       │   ├── celery.py
│       │   ├── settings.py
│       │   ├── settings_test.py
│       │   ├── tests.py
│       │   ├── urls.py
│       │   └── wsgi.py
│       ├── logs
│       ├── manage.py
│       ├── monitoring
│       │   ├── __init__.py
│       │   ├── admin.py
│       │   ├── apps.py
│       │   ├── management
│       │   │   ├── __init__.py
│       │   │   └── commands
│       │   │       ├── __init__.py
│       │   │       ├── cleanup.py
│       │   │       └── load_nist_data.py
│       │   ├── migrations
│       │   │   ├── __init__.py
│       │   ├── models.py
│       │   ├── tasks.py
│       │   ├── tests
│       │   │   ├── test_integration.py
│       │   │   ├── test_load_nist_data.py
│       │   │   ├── test_logging.py
│       │   │   ├── test_models.py
│       │   │   └── test_tasks.py
│       │   ├── tests.py
│       │   └── views.py
│       ├── pytest.ini
│       └── staticfiles
│           └── admin
│               ├── css
│               │   ├── vendor
│               │   │   └── select2
│               ├── img
│               │   ├── gis
│               └── js
│                   ├── admin
│                   └── vendor
│                       ├── jquery
│                       ├── select2
│                       │   ├── LICENSE.md
│                       │   ├── i18n
│                       └── xregexp
│                           ├── LICENSE.txt
├── docker-compose-dev.yaml
├── docker-entrypoint.sh
├── requirements.txt
├── supervisord.conf


- Dockerfile

- requirements.txt

- supervisord.conf

- docker-entrypoint.sh

- deployment.yml

- settings.py

- celery.py

- tests.py

- tasks.py

- cleanup.py

- load_nist_data.py


- UI Sample

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Factory Dashboard</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        .card {
            margin-bottom: 20px;
        }
        .live-data-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">Factory Dashboard</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item active">
                    <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                </li>
                </ul>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-12">
                <h1>Machine Data Dashboard</h1>
            </div>
        </div>

        <div class="row">

            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        Latest Data
                    </div>
                    <div class="card-body">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Data Type</th>
                                    <th>Item ID</th>
                                    <th>Timestamp</th>
                                    <th>Name</th>
                                    <th>Value</th>
                                </tr>
                            </thead>
                            <tbody id="latest-data-table">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        Time Range Filter
                    </div>
                    <div class="card-body">
                        <select id="time-range-select" class="form-control">
                            <option value="hour">Last Hour</option>
                            <option value="day">Last Day</option>
                            <option value="week">Last Week</option>
                        </select>
                        <button id="filter-button" class="btn btn-primary mt-2">Filter</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        Filtered Data
                    </div>
                    <div class="card-body">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Data Type</th>
                                    <th>Item ID</th>
                                    <th>Timestamp</th>
                                    <th>Name</th>
                                    <th>Value</th>
                                </tr>
                            </thead>
                            <tbody id="filtered-data-table">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>

        <div class="live-data-indicator">
            Last Updated: <span id="last-updated">Loading...</span>
        </div>
    </div>
</body>
</html>

You are a Full Stack Developer helping me with factorydash project.




## DESCRIPTION

You are a full-stack software developer highly experienced with Server Sider Rendering.
This project aims to provide Real-time insights for Smart Manufacturing.
I am working on this project for my porftolio.
I intend to strengthen my skills in modern Server-Side Rendering with this stage of the project.
Think as an strict IT interviewer.

## CONTEXT

- Generate docstrings for all python files, following best practices.
- Use type hints for all functions and methods.
- A working dashboard that pulls & displays NIST machine data
- Django Templates + Bootstrap for UI (keeping it simple).
- Add Real-Time Data Updates 
  - Use Django’s WebSockets (Django Channels).
  - Implement live updates for key metrics on the dashboard.
  - Show a timestamp indicating when data was last updated.
- Implement Data Display.
  - Create views & templates to display machine metrics.
  - Use Django ORM queries to retrieve data.
- Add a "Live Data" Indicator:
  - Show last updated timestamp to indicate when the data was last fetched.

 ## IMPROVEMENTS

- Create a table with the following columns, timestamp ordered, updated in real-time:
    - "Timestamp" (key: timestamp);
    - "Machine ID" (key: data_item_id);
    - "Parameter" (key: name);
    - "Value" (key: value).
- Keep the Last Update (live-indicator). It is working.
- The UI must be simple, beautiful and responsive.
- Files:
    - monitoring/templates/monitoring/dashboard.html
    - monitoring/models.py
    - monitoring/consumers.py
- Observation:
    - The WebSocket connetion is working well. 
      Also, the celery beat and the django task are OK.
      Take care with these.
    - Keep it simple.



Fields?

<Events>
    <Availability dataItemId="GFAgie01-dtop_1" timestamp="2025-03-25T04:00:56.124997" name="avail" sequence="594301694">AVAILABLE</Availability>
    <EmergencyStop dataItemId="GFAgie01-dtop_2" timestamp="2025-03-25T04:00:56.125112" name="estop" sequence="594301695">ARMED</EmergencyStop>
</Events>

<ComponentStream component="Rotary" name="C" componentId="Hurco02-C">
    <Samples>
        <RotaryVelocity dataItemId="Hurco02-C_1" timestamp="2025-03-25T20:40:31.572214" name="Spindle_Speed" sequence="594968640" subType="ACTUAL">3105.000000</RotaryVelocity>
    </Samples>
    <Events>
        <RotaryVelocityOverride dataItemId="Hurco02-C_2" timestamp="2025-03-25T20:40:31.571782" name="Spindle_Override" sequence="594968639">69.000000</RotaryVelocityOverride>
    </Events>
</ComponentStream>


<ComponentStream component="Path" name="Path" componentId="Hurco02-path">
    <Samples>
        <PathFeedrateOverride dataItemId="Hurco02-path_10" timestamp="2025-03-25T20:40:40.774760" name="Feed_Override" sequence="594968936">90.000000</PathFeedrateOverride>
        <PathFeedrateOverride dataItemId="Hurco02-path_11" timestamp="2025-03-25T20:10:12.495884" name="Rapid_Override" sequence="594942240" subType="RAPID">100.000000</PathFeedrateOverride>
        <AccumulatedTime dataItemId="Hurco02-path_7" timestamp="2025-03-25T20:41:54.440824" name="Program_Runtime_Seconds" sequence="594969889">2905</AccumulatedTime>
        <AccumulatedTime dataItemId="Hurco02-path_8" timestamp="2025-03-25T20:35:10.200871" name="Spindle_Time" sequence="594963895">7240914.1548</AccumulatedTime>
        <PathFeedrate dataItemId="Hurco02-path_9" timestamp="2025-03-25T20:41:53.993991" name="Feed_Rate" sequence="594969876" subType="ACTUAL">20.95</PathFeedrate>
    </Samples>
    <Events>
        <Line dataItemId="Hurco02-path_1" timestamp="2025-03-25T20:41:55.340769" name="Block_Number" sequence="594969904">9077</Line>
        <Program dataItemId="Hurco02-path_2" timestamp="2025-03-25T19:50:05.170805Z" name="Program_Name_Running" sequence="594925338">UNAVAILABLE</Program>
        <ProgramEditName dataItemId="Hurco02-path_3" timestamp="2025-03-25T19:50:05.170805Z" name="Program_Name_Editing" sequence="594925339">UNAVAILABLE</ProgramEditName>
        <PartCount dataItemId="Hurco02-path_4" timestamp="2025-03-25T17:23:55.007469Z" name="Part_Count" sequence="594810180" subType="ALL">UNAVAILABLE</PartCount>
        <Execution dataItemId="Hurco02-path_5" timestamp="2025-03-25T19:50:05.170805Z" name="Program_Status" sequence="594925340">UNAVAILABLE</Execution>
        <ToolNumber dataItemId="Hurco02-path_6" timestamp="2025-03-25T20:09:19.243494" name="Current_Tool" sequence="594941454">10.000000</ToolNumber>
    </Events>
</ComponentStream>


<ComponentStream component="Rotary" name="C" componentId="Hurco04-C">
    <Samples>
        <RotaryVelocity dataItemId="Hurco04-C_1" timestamp="2025-03-25T20:20:22.778357" name="Spindle_Speed" sequence="594951508" subType="ACTUAL">9000.000000</RotaryVelocity>
    </Samples>
    <Events>
        <RotaryVelocityOverride dataItemId="Hurco04-C_2" timestamp="2025-03-25T14:05:17.267295Z" name="Spindle_Override" sequence="594620081">UNAVAILABLE</RotaryVelocityOverride>
    </Events>
</ComponentStream>


<ComponentStream component="Path" name="Path" componentId="Hurco04-path">
    <Samples>
        <PathFeedrateOverride dataItemId="Hurco04-path_10" timestamp="2025-03-25T14:05:17.267295Z" name="Feed_Override" sequence="594620083">UNAVAILABLE</PathFeedrateOverride>
        <PathFeedrateOverride dataItemId="Hurco04-path_11" timestamp="2025-03-25T14:35:12.873886" name="Rapid_Override" sequence="594648436" subType="RAPID">52.000000</PathFeedrateOverride>
        <AccumulatedTime dataItemId="Hurco04-path_7" timestamp="2025-03-25T20:41:44.930071" name="Program_Runtime_Seconds" sequence="594969806">707</AccumulatedTime>
        <AccumulatedTime dataItemId="Hurco04-path_8" timestamp="2025-03-25T20:22:49.488621" name="Spindle_Time" sequence="594953969">6682301.3088</AccumulatedTime>
        <PathFeedrate dataItemId="Hurco04-path_9" timestamp="2025-03-25T20:41:53.778109" name="Feed_Rate" sequence="594969875" subType="ACTUAL">8.8</PathFeedrate>
    </Samples>
    <Events>
        <Line dataItemId="Hurco04-path_1" timestamp="2025-03-25T20:41:55.747543" name="Block_Number" sequence="594969911">1888</Line>
        <Program dataItemId="Hurco04-path_2" timestamp="2025-03-25T19:58:30.433737" name="Program_Name_Running" sequence="594932794">NIST_MTC_CRADA_PLATE-15.NC</Program>
        <ProgramEditName dataItemId="Hurco04-path_3" timestamp="2025-03-25T19:58:15.946187" name="Program_Name_Editing" sequence="594932649">NIST_MTC_CRADA_PLATE-15.NC</ProgramEditName>
        <PartCount dataItemId="Hurco04-path_4" timestamp="2025-03-25T19:55:45.484638" name="Part_Count" sequence="594930924" subType="ALL">1081</PartCount>
        <Execution dataItemId="Hurco04-path_5" timestamp="2025-03-25T19:58:30.224917" name="Program_Status" sequence="594932793">ACTIVE</Execution>
        <ToolNumber dataItemId="Hurco04-path_6" timestamp="2025-03-25T20:20:19.608842" name="Current_Tool" sequence="594951404">5.000000</ToolNumber>
    </Events>
</ComponentStream>



<ComponentStream component="Rotary" name="S" componentId="Mazak03-S_1">                                                                     
    <Samples>
        <RotaryVelocity dataItemId="Mazak03-S_2" timestamp="2025-03-25T20:56:52.953080" name="Srpm" sequence="594980851" subType="ACTUAL">750</RotaryVelocity>
            <Load dataItemId="Mazak03-S_3" timestamp="2025-03-25T20:56:52.953171" name="S1load" sequence="594980852">1</Load>
            <Temperature dataItemId="Mazak03-S_4" timestamp="2025-03-25T20:56:52.953245" name="Stemp" sequence="594980853">40</Temperature>         
    </Samples>                                                                                                                                
    <Condition>                                                                                                                                 
        <Normal dataItemId="Mazak03-S_5" timestamp="2025-03-25T20:56:52.953317" name="Sload_cond" sequence="594980854" type="LOAD"/>              
        <Normal dataItemId="Mazak03-S_6" timestamp="2025-03-25T20:56:52.953397" name="Stemp_cond" sequence="594980855" type="TEMPERATURE"/>                                                                                                                                               
    </Condition>                                                                                                                            
</ComponentStream> 


The function named "parse_nist_xml" is in charge of the nist xml parsing.
Rewrite the function to extract only the following fields:
- Streams/DeviceStream/ComponentStream/Events/Availability
- Streams/DeviceStream/ComponentStream/Events/EmergencyStop
- Streams/DeviceStream/ComponentStream/Samples/Xfrt
- Streams/DeviceStream/ComponentStream/Samples/Yfrt
- Streams/DeviceStream/ComponentStream/Samples/Zfrt
- Streams/DeviceStream/ComponentStream/Samples/Xposition
- Streams/DeviceStream/ComponentStream/Samples/Yposition
- Streams/DeviceStream/ComponentStream/Samples/Zposition
- Streams/DeviceStream/ComponentStream/Samples/Temperature
- Streams/DeviceStream/ComponentStream/Samples/AccumulatedTime
- Streams/DeviceStream/ComponentStream/Samples/PathFeedRate
- Streams/DeviceStream/ComponentStream/Samples/RotaryVelocity

Is important to improve the performance as much as possible.
The function signature and the return (yield) has to be kept.

I will share the file, wait.


record = {
                    "data_type": data_type,
                    "data_item_id": element.attrib.get("dataItemId", "").strip(),
                    "timestamp": timestamp,
                    "name": element.tag.split("}")[1].strip() if "}" in element.tag else element.tag.strip(),
                    "value": element.text.strip() if element.text else None,
                }